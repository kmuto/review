#!/usr/bin/env ruby
#
# review: Wrapper command to call subcommand
#
# ex.
#    review epubmaker config.yml
#      -> call `review-epubmaker config.yml`
#

require 'pathname'

def usage
  message = <<-EOB
usage: review <command> [<args>]

ReVIEW commands are:
  init
  preproc
  compile
  epubmaker
  webmaker
  pdfmaker
  textmaker
  vol
  check
  index
  validate
EOB
  print message
  exit 1
end

usage if ARGV.length == 0

if ARGV[0] && ARGV[0].start_with?('-')
  cmdopt = ARGV[0]
  case cmdopt
  when '-h', '--help'
    usage()
    exit 0
  when '-v', '--version'
    require 'review/version'
    puts "Re:VIEW #{ReVIEW::VERSION}"
    exit 0
  else
    $stderr.puts "#{cmdopt}: unknown option."
    exit 1
  end
end

command = "review-#{ARGV.shift}"
bindir = Pathname.new(__FILE__).realpath.dirname
command_path = File.join(bindir, command)

unless File.exist?(command_path)
  print "cannot find command: #{command}\n\n"
  usage
end

exec(command_path, *ARGV)
